<div class="wikidoc"><h1>Result Publisher Filters</h1>Result Publisher Filters provide fine control over which HealthCheck results are published - this allows you to tune your Wolfpack system to your specific notification requirements. Wolfpack provides two options for controlling the result output of a HealthCheck...
<ol><li>A check may implement it&#39;s own filter - this stops results at the source. Examples of this include the SqlScalar and the UrlPing HealthCheck which have a &quot;PublishOnlyIfFailure&quot; configuration setting. However a filter here may be too restrictive - you might want to send the result to one publisher but not another so...</li>
<li>A Result Publisher Filter can be used - these are filters attached to the publisher end of the notification workflow; you can attach a filter to each enabled publisher to independently inspect and decide whether that specific publisher should actually publish the result emitted by the health check(s).
<ul><li>eg: You have a UrlPing check running and want to record the response time so you configure the SQLite publisher and store these results in a SQLite database. You also want to be notified if a UrlPing fails so you enable the Growl publisher; Growl popups then start appearing all the time for successful pings too...not what we wanted! So we can attach a filter to target the UrlPing check and the Growl publisher combination - when it receives a &quot;success&quot; result it just throws it away - only &quot;failure&quot; results are forwarded onto the Growl publisher.</li></ul></li></ol>
Result Publisher Filters work using method interception, they decide whether they should intercept the call to publish a result by examining their configuration and then comparing it to the result and publisher being invoked - if the filter should be applied it will execute its logic to decide whether the Publisher should be called or not.<br /><br />Result Publisher Filters sit between Wolfpack and it&#39;s Publishers and because Wolfpack architecture is consistent when an Agent is running remotely or locally (eg: in a distributed layout with many remote Agents publishing result data to a central &quot;server&quot; Agent or just as a single Agent running HealthChecks) it means that Filters can be applied exactly the same. In the distributed layout each remote Agent can have Filters to ensure that it transmits only the correct data and more Filters can be applied to the &quot;server&quot; Agent to then fine control the Publishers that it then invokes.<br /><br /><b>NOTE</b> You can create as many filters as you like, they will all fire when a result message is published (although order is undefined as the moment). If there are multiple filters that apply to the same publisher or check then they essentially are all &quot;voting&quot; on whether to publish the result - if any one Filter &quot;votes&quot; no then the Result is discarded regardless of how many other Filters &quot;vote&quot; yes.<br />
<h2>Example</h2>To use the built-in Wolfpack Core &quot;SuccessFilter&quot; as an example - this filter examines the &quot;result&quot; property (bool, true/false) of a Wolfpack HealthCheck Result message to decide whether to publish it based on it&#39;s configuration. All Filter configuration should be found in the config\filter.castle.config file. It has four configuration properties, two that are common to all Filters and two specific to this Filter; these are...
<ul><li>Common properties. These belong on ALL Filters and allow you target different Publisher/HealthCheck combinations
<ul><li><b>Publisher</b> - Use * to attach to all Publishers or provide the &quot;FriendlyId&quot; name of a specific Publisher. The &quot;FriendlyId&quot; can be found in the publisher.castle.config file against each Publisher.</li>
<li><b>Check</b> - Use * to attach to all HealthChecks or provide the &quot;FriendlyId&quot; name of a specific HealthCheck. The &quot;FriendlyId&quot; can be found in the check.castle.config file against each HealthCheck.</li></ul></li>
<li>Specific properties - these are custom properties found only on this specific Filter.
<ul><li><b>PublishSuccess</b> - if a HealthCheck result is &quot;true&quot; (pass) and you wish to publish this then set this property to &quot;true&quot;. In many cases though you will want to suppress the publication of a successful HealthCheck - often you are only interested in the failures so set this to false.</li>
<li><b>PublishFailure</b> - if a HealthCheck result is &quot;false&quot; (fail) and you wish to publish this then set this property to &quot;true&quot;. In the majority of cases you will want to set this to &quot;true&quot; so that failures are published and you are notified of them.</li></ul></li></ul>
<h3>Configuration Examples</h3>In all cases please uncomment the &quot;ResultFilter&quot; component in the config\filter.castle.config file.
<ul><li>You don&#39;t want to publish ANY successful HealthCheck results - you are only interested in Failures
<ul><li>Set the <b>Publisher</b> property to &quot;*&quot;</li>
<li>Set the <b>Check</b> property to &quot;*&quot;</li>
<li>Set the <b>PublishSuccess</b> property to &quot;false&quot;</li>
<li>Set the <b>PublishFailure</b> property to &quot;true&quot;</li></ul></li></ul>

<ul><li>You want to publish ALL HealthCheck results to the SQLite publisher but don&#39;t want sucessful HealthCheck results to be sent to Growl - you only want to be notified of &quot;failures&quot; via Growl.
<ul><li>Set the <b>Publisher</b> property to &quot;Growl&quot;</li>
<li>Set the <b>Check</b> property to &quot;*&quot;</li>
<li>Set the <b>PublishSuccess</b> property to &quot;false&quot;</li>
<li>Set the <b>PublishFailure</b> property to &quot;true&quot;</li></ul></li></ul>

<h2>Custom Filters</h2>You can easily create your own Filters to encapsulate your custom logic to decide whether a result should be published. Your Filter has access to the full HealthCheckResult entity that is attempting to be published along with the Publisher instance being invoked (remember the Filter will be invoked for all publisher/check combinations that it applies to).
<ol><li>Create a new class and make sure you have a reference to the Wolfpack.Core assembly.</li>
<li>Inherit from Wolfpack.Core.Filters.ResultFilterBase</li>
<li>Implement the &quot;ShouldPublish&quot; method. This method is called by the base class and passes the HealthCheck Result and the Publisher instance. This should hold your custom logic to inspect the Result and decide whether it should publish it or abort (throw away the result); simply return &quot;true&quot; to publish or &quot;false&quot; to abort.</li>
<li>Add a public property for any behaviour you want to configure on the Filter - these values can then be set in the configuration file.</li>
<li>Register your custom Filter in the configuration file.
<ol><li>In config\filter.castle.config create a new &quot;component&quot; and give it a new unique &quot;id&quot; attribute value. The easiest way is to copy the &quot;ResultFilter&quot; component as a template or use the one below.</li>
<li>Set the &quot;type=&quot; to the fully qualified class name of your new Filter and remember to set the correct assemble name (this is the bit after the comma)</li>
<li>If you added any public properties you can to pass values into then add them inside the &lt;parameters&gt; tag. The name of the property should be used as the tag name. Set the value as required.</li></ol></li></ol>

<h3>Custom Filter Template</h3>Here is a template to use as a starter for your custom Filter. Please update any values in CAPS and <b>make sure that it appears inside</b> the &lt;components&gt; tags.<br /><div style="color:Black;background-color:White;"><pre>
    <span style="color:Blue;">&lt;</span><span style="color:#A31515;">component</span> <span style="color:Red;">id</span><span style="color:Blue;">=</span><span style="color:Black;">&quot;</span><span style="color:Blue;">YOUR-UNIQUE-NAME</span><span style="color:Black;">&quot;</span>
            <span style="color:Red;">lifestyle</span><span style="color:Blue;">=</span><span style="color:Black;">&quot;</span><span style="color:Blue;">transient</span><span style="color:Black;">&quot;</span>
            <span style="color:Red;">service</span><span style="color:Blue;">=</span><span style="color:Black;">&quot;</span><span style="color:Blue;">Wolfpack.Core.Interfaces.IPublisherFilter, Wolfpack.Core</span><span style="color:Black;">&quot;</span>
            <span style="color:Red;">type</span><span style="color:Blue;">=</span><span style="color:Black;">&quot;</span><span style="color:Blue;">YOUR-FILTER-CLASSNAME-INC-NAMESPACE, YOUR-ASSEMBLY-NAME-MINUS.DLL</span><span style="color:Black;">&quot;</span><span style="color:Blue;">&gt;</span>
      <span style="color:Blue;">&lt;</span><span style="color:#A31515;">parameters</span><span style="color:Blue;">&gt;</span>
        <span style="color:Green;">&lt;!-- REQUIRED PARAMETERS - DO NOT REMOVE --&gt;</span>
        <span style="color:Blue;">&lt;</span><span style="color:#A31515;">Publisher</span><span style="color:Blue;">&gt;</span>*<span style="color:Blue;">&lt;/</span><span style="color:#A31515;">Publisher</span><span style="color:Blue;">&gt;</span>
        <span style="color:Blue;">&lt;</span><span style="color:#A31515;">Check</span><span style="color:Blue;">&gt;</span>*<span style="color:Blue;">&lt;/</span><span style="color:#A31515;">Check</span><span style="color:Blue;">&gt;</span>
        <span style="color:Green;">&lt;!-- YOUR CUSTOM PARAMETERS HERE - THESE MUST MATCH THE CLASS PROPERTY NAME --&gt;</span>
      <span style="color:Blue;">&lt;/</span><span style="color:#A31515;">parameters</span><span style="color:Blue;">&gt;</span>
    <span style="color:Blue;">&lt;/</span><span style="color:#A31515;">component</span><span style="color:Blue;">&gt;</span>
</pre></div></div><div class="ClearBoth"></div>